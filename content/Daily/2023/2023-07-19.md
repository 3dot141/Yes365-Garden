---
aliases: []
created_date: 2023-07-19 00:00
draft: false
summary: ''
tags:
- daily
---

```dataviewjs

const currentPage = dv.current().file;
const dailyPages = dv.pages('"Daily"').sort(k=>k.file.name, "asc");
const currentPageName = currentPage.name;
const index = dailyPages.findIndex((e) => {return e.file.name === currentPageName});
if (index < 1) {
	dv.table(["File", "Created", "Size"],[]);
} else {
	const lastIndex = index - 1;
	const lastPage = dailyPages[lastIndex].file;
	const allPages = dv.pages().values;
	const searchPages = [];
	
	const lastTime = dv.parse(lastPage.name);
	const currentTime = dv.parse(currentPage.name);

	for (let page of allPages) {
		const pageFile = page.file;
		if (pageFile.cday > lastTime && pageFile.cday <= currentTime) {
		  searchPages.push(pageFile);
		}
	}
	dv.table(["File", "Created", "Size"], searchPages.sort((a, b) => a.ctime > b.ctime ? 1 : -1).map(b => [b.link, b.ctime, b.size]));
}

```

## 反序列化漏洞

[JavaSec Fastjson反序列化漏洞利用原理 | thonsun's blog](https://thonsun.github.io/2020/11/20/fastjson-fan-xu-lie-hua-lou-dong-li-yong-yuan-li/)  
[JavaSec Jackjson反序列化漏洞利用原理 | thonsun's blog](https://thonsun.github.io/2020/11/02/jackjson-fan-xu-lie-hua-lou-dong-li-yong-yuan-li/)

1. Jackson 开启 Defualt Type 支持
	1. `com.fasterxml.jackson.databind.ObjectMapper#enableDefaultTyping()`
	2. 输出信息 `{'object':["classpath", {"value": "test"}]} `
	3. 反序列化时，就会通过 classpath 反序列化对应的类，并触发 `setXX` 
2. 服务端 classpath 存在可以利用的类，如 `com.sun.rowset.JdbcRowSetImpl`,target 类满足 `setXX` 可控触发 **JDNI** 注入利用。

[JDK反序列化漏洞](Attachments/9062d9d463c1b4e65b3bad4ef81a0919_MD5.pdf)

- `com.fr.third.org.apache.commons.collections4.bag.TreeBag#readObject`
	- `com.fr.third.org.apache.commons.collections4.bag.AbstractMapBag#doReadObject（Map<>）` - 传入 `TreeMap`
		- `java.util.TreeMap#put`
			- `java.util.TreeMap#compare`
				- `java.util.Comparator#compare`
					- `com.fr.base.core.serializable.SerialableLocalCollator#compare`
						- `com.fr.json.JSONArray#toString` - 调用 `getXXX`
							- `java.security.SignedObject#getObject` - 调用 `getXXX`

JDK 反序列化漏洞的危险性是成倍提升的。因为支持了 `inputstream` 所以可以传入不存在的 `class` 进行攻击。

> 核心都是反序列化 class 的时候会出现问题。